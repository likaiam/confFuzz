CREATE VIRTUAL TABLE v0 USING fts4 ( v1 INTEGER AS( nth_value ( v2 , 3 ) OVER( ORDER BY v2 ) + nth_value ( v2 , 1 ) OVER( ) ) , v2 ) ; DELETE FROM v0 WHERE v1 IS NOT NULL OR abs ( v2 ) < 1 ; CREATE TABLE v3 ( v4 NOT NULL ON CONFLICT IGNORE CHECK( datetime ( - - v4 IS NOT NULL , v4 ) NOT LIKE substr ( v4 , 9223372036854775808.000000 , 9223372036854775807 ) ) PRIMARY KEY UNIQUE NOT NULL ) ; ALTER TABLE v0 RENAME TO v1 ; SELECT v1 , v2 FROM v0 WHERE v2 IS NOT NULL ; 